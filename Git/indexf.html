<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title></title>
  </head>
<body>
  <section class="container">
    <form id="form" onsubmit="saveToLocalStorage(event)">
      <div>
        <label for="name">Name:</label>
        <input type="text" id="name">
      </div>
      <div>
        <label for="emailId">Email:</label>
        <input type="text" id="emailId">
      </div>
      <div>
        <label for="phone_number">Phone Number:</label>
        <input type="text" id="phone_number">
      </div>
      <input class="btn" type="submit" value="Submit">
    </form>

    <ul id="users"></ul>
  </section>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
  <script>
    function saveToLocalStorage(event) {
      event.preventDefault();
      const form = document.getElementById("form");
      const name = document.getElementById("name").value;
      const emailId = document.getElementById("emailId").value;
      const phoneNumber = document.getElementById("phone_number").value;

      // Create a new user
      const user = {
        name: name,
        emailId: emailId,
        phoneNumber: phoneNumber,
      };

      const newUsers = JSON.parse(localStorage.getItem("users")) || [];
      newUsers.push(user);
      localStorage.setItem("users", JSON.stringify(newUsers));

      axios.post("https://crudcrud.com/api/366e1a22c28e4d19a7995dfe16f26f53/appointmentData", user)
        .then((response) => {
          // Only call showNewUserOnScreen after submitting the form, not here.
          console.log(response);
        })
        .catch((error) => {
          console.log("Error saving user:", error);
        });

      form.reset();

      displayUsers();
    }

    function deleteUserFromCrudCrud(userId) {
      axios.delete(`https://crudcrud.com/api/366e1a22c28e4d19a7995dfe16f26f53/appointmentData/${userId}`)
        .then((response) => {
          console.log("User deleted successfully:", response);
        })
        .catch((error) => {
          console.log("Error deleting user:", error);
        });
    }
    
    function deleteUser(index, user) {
      deleteUserFromCrudCrud(user);

      const users = JSON.parse(localStorage.getItem("users")) || [];
      users.splice(index, 1);
      localStorage.setItem("users", JSON.stringify(users));
      displayUsers();
    }

    function editUser(index) {
      const users = JSON.parse(localStorage.getItem("users")) || [];
      const user = users[index];
      // Set the form values to the user's information for editing
      document.getElementById("name").value = user.name;
      document.getElementById("emailId").value = user.emailId;
      document.getElementById("phone_number").value = user.phoneNumber;
      users.splice(index, 1);
      localStorage.setItem("users", JSON.stringify(users));
      displayUsers();
    }

    function displayUsers() {
      axios.get("https://crudcrud.com/api/366e1a22c28e4d19a7995dfe16f26f53/appointmentData")
        .then((response) => {
          const users = response.data || [];
          const userList = document.getElementById("users");
          userList.innerHTML = "";
          users.forEach((user, index) => {
            const listItem = document.createElement("li");
            listItem.textContent = `Name: ${user.name}, Email: ${user.emailId}, Phone Number: ${user.phoneNumber}`;
            const deleteIcon = document.createElement("i");
            deleteIcon.classList.add("fas", "fa-trash-alt", "delete-icon");
            deleteIcon.addEventListener("click", function () {
              deleteUser(index, user._id);
            });
            listItem.appendChild(deleteIcon);
            userList.appendChild(listItem);
          });
        })
        .catch((error) => {
          console.log("Error fetching users:", error);
        });
    }

    displayUsers();
  </script>
</body>
</html>